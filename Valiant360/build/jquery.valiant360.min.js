/*! jquery.valiant360 - v0.0.10 - 2014-01-27
 * Copyright (c) 2014 Charlie Hoey <me@charliehoey.com>; Licensed MIT */
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.id="webgl-error-message",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}};!function(){function a(a){q=this,this.options=$.extend({},v,a),r=this.options.lat,s=this.options.lon,t=this.options.fov,m=new THREE.Scene,l=new THREE.PerspectiveCamera(this.options.fov,this.width()/this.height(),.1,1e3),n=Detector.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer,n.setSize(this.width(),this.height()),n.autoClear=!1,n.setClearColor(16777215,1),this.append(n.domElement),o=document.createElement("video"),o.loop=this.options.loop,o.muted=this.options.muted,p=new THREE.Texture(o),p.generateMipmaps=!1,p.minFilter=THREE.LinearFilter,p.magFilter=THREE.LinearFilter,p.format=THREE.RGBFormat,mesh=new THREE.Mesh(new THREE.SphereGeometry(500,80,50),new THREE.MeshBasicMaterial({map:p})),mesh.scale.x=-1,m.add(mesh),o.addEventListener("ended",function(){k("video loaded")}),o.addEventListener("progress",function(){var a=null;o&&o.buffered&&o.buffered.length>0&&o.buffered.end&&o.duration?a=o.buffered.end(0)/o.duration:o&&void 0!=o.bytesTotal&&o.bytesTotal>0&&void 0!=o.bufferedBytes&&(a=o.bufferedBytes/o.bytesTotal);Math.round(100*a)}),o.addEventListener("canplaythrough",function(){1==q.options.autoplay&&o.play(),i(),k("playing")}),o.src=this.attr("data-video-src")}function b(){this.append(x,!0),c()}function c(){function a(a){if(onPointerDownPointerX=a.clientX,onPointerDownPointerY=-a.clientY,onPointerDownLon=s,onPointerDownLat=r,$(q).find("canvas").is(":hover")){var b=a.pageX-$(q).find("canvas").offset().left,c=a.pageY-$(q).find("canvas").offset().top;s=b/$(q).find("canvas").width()*430-225,r=c/$(q).find("canvas").height()*-180+90}}function b(a){var b=-.01;a.wheelDeltaY?t-=a.wheelDeltaY*b:a.wheelDelta?t-=a.wheelDelta*b:a.detail&&(t+=1*a.detail);var c=3,d=100;c>t?t=c:t>d&&(t=d),$(q).find("canvas").is(":hover")&&(l.setLens(t),a.preventDefault())}document.addEventListener("mousemove",a,!1),document.addEventListener("mousewheel",b,!1),document.addEventListener("DOMMouseScroll",b,!1),$(q).find(".playButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-pause")?($(this).removeClass("fa-pause").addClass("fa-play"),g()):($(this).removeClass("fa-play").addClass("fa-pause"),f())}),$(q).find(".pauseButton").click(function(a){a.preventDefault(),g()}),$(q).find(".fullscreenButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-expand")?$(q)[0].webkitRequestFullscreen():($(this).removeClass("fa-compress").addClass("fa-expand"),document.webkitExitFullscreen())}),$(q).find(".muteButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-volume-off")?($(this).removeClass("fa-volume-off").addClass("fa-volume-up"),o.muted=!1):($(this).removeClass("fa-volume-up").addClass("fa-volume-off"),o.muted=!0)})}function d(){if(window.screenTop||window.screenY){var a=screen.width,b=screen.height;y=!0}else{var a=q.originalWidth,b=q.originalHeight;y=!1}e(a,b),y?($(q).addClass("fullscreen"),$(q).find("a.fa-expand").removeClass("fa-expand").addClass("fa-compress")):($(q).removeClass("fullscreen"),$(q).find("a.fa-compress").removeClass("fa-compress").addClass("fa-expand"))}function e(a,b){n.setSize(a,b),l.aspect=a/b,l.updateProjectionMatrix()}function f(){o.play()}function g(){o.pause()}function h(a){o.src=a}function i(){if(requestAnimationFrame(i),o.readyState===o.HAVE_ENOUGH_DATA&&"undefined"!=typeof p){var a=(new Date).getTime();a-w>=30&&(p.needsUpdate=!0,w=a)}j()}function j(){r=Math.max(-85,Math.min(85,r)),phi=(90-r)*Math.PI/180,theta=s*Math.PI/180;var a=500*Math.sin(phi)*Math.cos(theta),b=500*Math.cos(phi),c=500*Math.sin(phi)*Math.sin(theta);l.lookAt(new THREE.Vector3(a,b,c)),l.position.x=-a,l.position.y=-b,l.position.z=-c,n.clear(),n.render(m,l)}function k(a){console.info(a)}var l,m,n,o,p,q,r,s,t,u={play:f,stop:g,fullscreen:d,loadVideo:h},v={fov:35,lon:0,lat:0,loop:"loop",muted:!0,debug:!1,autoplay:!0},w=(new Date).getTime(),x='         <div class="controls">             <a href="#" class="playButton button fa fa-pause"></a>             <a href="#" class="muteButton button fa fa-volume-off"></a>             <a href="#" class="fullscreenButton button fa fa-expand"></a>         </div>     ',y=!1;$.fn.Valiant360=function(){if("string"==typeof arguments[0]){var c=(arguments[1],Array.prototype.slice.call(arguments));c.splice(0,1),u[arguments[0]].apply(this,c)}else a.apply(this,arguments),b.apply(this,arguments);return this.originalWidth=$(this).find("canvas").width(),this.originalHeight=$(this).find("canvas").height(),$(q).addClass("Valiant360_default"),this},$(window).resize(function(){e($(q).width(),$(q).height())}),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",d)}(jQuery);