/*! jquery.valiant360 - v0.0.9 - 2014-01-26
 * Copyright (c) 2014 Charlie Hoey <me@charliehoey.com>; Licensed MIT */
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.id="webgl-error-message",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}};!function(){function a(a){p=this,this.options=$.extend({},u,a),q=this.options.lat,r=this.options.lon,s=this.options.fov,l=new THREE.Scene,k=new THREE.PerspectiveCamera(this.options.fov,this.width()/this.height(),.1,1e3),m=Detector.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer,m.setSize(this.width(),this.height()),m.autoClear=!1,m.setClearColor(16777215,1),this.append(m.domElement),n=document.createElement("video"),n.loop=this.options.loop,n.muted=this.options.muted,o=new THREE.Texture(n),o.generateMipmaps=!1,o.minFilter=THREE.LinearFilter,o.magFilter=THREE.LinearFilter,o.format=THREE.RGBFormat,mesh=new THREE.Mesh(new THREE.SphereGeometry(500,80,50),new THREE.MeshBasicMaterial({map:o})),mesh.scale.x=-1,l.add(mesh),n.addEventListener("ended",function(){j("video loaded")}),n.addEventListener("progress",function(){var a=null;n&&n.buffered&&n.buffered.length>0&&n.buffered.end&&n.duration?a=n.buffered.end(0)/n.duration:n&&void 0!=n.bytesTotal&&n.bytesTotal>0&&void 0!=n.bufferedBytes&&(a=n.bufferedBytes/n.bytesTotal);Math.round(100*a)}),n.addEventListener("canplaythrough",function(){1==p.options.autoplay&&n.play(),h(),j("playing")}),n.src=this.attr("data-video-src")}function b(){this.append(w,!0),c()}function c(){function a(a){if(onPointerDownPointerX=a.clientX,onPointerDownPointerY=-a.clientY,onPointerDownLon=r,onPointerDownLat=q,$(p).find("canvas").is(":hover")){var b=a.pageX-$(p).find("canvas").offset().left,c=a.pageY-$(p).find("canvas").offset().top;r=b/$(p).find("canvas").width()*430-225,q=c/$(p).find("canvas").height()*-180+90}}function b(a){var b=-.01;a.wheelDeltaY?s-=a.wheelDeltaY*b:a.wheelDelta?s-=a.wheelDelta*b:a.detail&&(s+=1*a.detail);var c=3,d=100;c>s?s=c:s>d&&(s=d),$(p).find("canvas").is(":hover")&&(k.setLens(s),a.preventDefault())}document.addEventListener("mousemove",a,!1),document.addEventListener("mousewheel",b,!1),document.addEventListener("DOMMouseScroll",b,!1),$(p).find(".playButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-pause")?($(this).removeClass("fa-pause").addClass("fa-play"),f()):($(this).removeClass("fa-play").addClass("fa-pause"),e())}),$(p).find(".pauseButton").click(function(a){a.preventDefault(),f()}),$(p).find(".fullscreenButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-expand")?$(p)[0].webkitRequestFullscreen():($(this).removeClass("fa-compress").addClass("fa-expand"),document.webkitExitFullscreen())}),$(p).find(".muteButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-volume-off")?($(this).removeClass("fa-volume-off").addClass("fa-volume-up"),n.muted=!1):($(this).removeClass("fa-volume-up").addClass("fa-volume-off"),n.muted=!0)})}function d(){if(window.screenTop||window.screenY){var a=screen.width,b=screen.height;x=!0}else{var a=p.originalWidth,b=p.originalHeight;x=!1}m.setSize(a,b),k.aspect=a/b,k.updateProjectionMatrix(),x?($(p).addClass("fullscreen"),$(p).find("a.fa-expand").removeClass("fa-expand").addClass("fa-compress")):($(p).removeClass("fullscreen"),$(p).find("a.fa-compress").removeClass("fa-compress").addClass("fa-expand"))}function e(){n.play()}function f(){n.pause()}function g(a){n.src=a}function h(){if(requestAnimationFrame(h),n.readyState===n.HAVE_ENOUGH_DATA&&"undefined"!=typeof o){var a=(new Date).getTime();a-v>=30&&(o.needsUpdate=!0,v=a)}i()}function i(){q=Math.max(-85,Math.min(85,q)),phi=(90-q)*Math.PI/180,theta=r*Math.PI/180;var a=500*Math.sin(phi)*Math.cos(theta),b=500*Math.cos(phi),c=500*Math.sin(phi)*Math.sin(theta);k.lookAt(new THREE.Vector3(a,b,c)),k.position.x=-a,k.position.y=-b,k.position.z=-c,m.clear(),m.render(l,k)}function j(a){console.info(a)}var k,l,m,n,o,p,q,r,s,t={play:e,stop:f,fullscreen:d,loadVideo:g},u={fov:35,lon:0,lat:0,loop:"loop",muted:!0,debug:!1,autoplay:!0},v=(new Date).getTime(),w='         <div class="controls">             <a href="#" class="playButton button fa fa-pause"></a>             <a href="#" class="muteButton button fa fa-volume-off"></a>             <a href="#" class="fullscreenButton button fa fa-expand"></a>         </div>     ',x=!1;$.fn.Valiant360=function(){if("string"==typeof arguments[0]){var c=(arguments[1],Array.prototype.slice.call(arguments));c.splice(0,1),t[arguments[0]].apply(this,c)}else a.apply(this,arguments),b.apply(this,arguments);return this.originalWidth=$(this).find("canvas").width(),this.originalHeight=$(this).find("canvas").height(),$(p).addClass("Valiant360_default"),this},$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",d)}(jQuery);