/*! jquery.valiant360 - v0.0.9 - 2014-01-26
 * Copyright (c) 2014 Charlie Hoey <me@charliehoey.com>; Licensed MIT */
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.id="webgl-error-message",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}};!function(){function a(a){o=this,this.options=$.extend({},t,a),p=this.options.lat,q=this.options.lon,r=this.options.fov,k=new THREE.Scene,j=new THREE.PerspectiveCamera(this.options.fov,this.width()/this.height(),.1,1e3),l=Detector.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer,l.setSize(this.width(),this.height()),l.autoClear=!1,l.setClearColor(16777215,1),this.append(l.domElement),m=document.createElement("video"),m.loop=this.options.loop,m.muted=this.options.muted,n=new THREE.Texture(m),n.generateMipmaps=!1,n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.format=THREE.RGBFormat,mesh=new THREE.Mesh(new THREE.SphereGeometry(500,80,50),new THREE.MeshBasicMaterial({map:n})),mesh.scale.x=-1,k.add(mesh),m.addEventListener("ended",function(){i("video loaded")}),m.addEventListener("progress",function(){var a=null;m&&m.buffered&&m.buffered.length>0&&m.buffered.end&&m.duration?a=m.buffered.end(0)/m.duration:m&&void 0!=m.bytesTotal&&m.bytesTotal>0&&void 0!=m.bufferedBytes&&(a=m.bufferedBytes/m.bytesTotal);Math.round(100*a)}),m.addEventListener("canplaythrough",function(){1==o.options.autoplay&&m.play(),g(),i("playing")}),m.src=this.attr("data-video-src")}function b(){this.append(u,!0),c()}function c(){function a(a){if(onPointerDownPointerX=a.clientX,onPointerDownPointerY=-a.clientY,onPointerDownLon=q,onPointerDownLat=p,$(o).find("canvas").is(":hover")){var b=a.pageX-$(o).find("canvas").offset().left,c=a.pageY-$(o).find("canvas").offset().top;q=b/$(o).find("canvas").width()*430-225,p=c/$(o).find("canvas").height()*-180+90}}function b(a){var b=-.01;a.wheelDeltaY?r-=a.wheelDeltaY*b:a.wheelDelta?r-=a.wheelDelta*b:a.detail&&(r+=1*a.detail);var c=3,d=100;c>r?r=c:r>d&&(r=d),$(o).find("canvas").is(":hover")&&(j.setLens(r),a.preventDefault())}document.addEventListener("mousemove",a,!1),document.addEventListener("mousewheel",b,!1),document.addEventListener("DOMMouseScroll",b,!1),$(o).find(".playButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-pause")?($(this).removeClass("fa-pause").addClass("fa-play"),f()):($(this).removeClass("fa-play").addClass("fa-pause"),e())}),$(o).find(".pauseButton").click(function(a){a.preventDefault(),f()}),$(o).find(".fullscreenButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-expand")?$(o)[0].webkitRequestFullscreen():($(this).removeClass("fa-compress").addClass("fa-expand"),document.webkitExitFullscreen())}),$(o).find(".muteButton").click(function(a){a.preventDefault(),$(this).hasClass("fa-volume-off")?($(this).removeClass("fa-volume-off").addClass("fa-volume-up"),m.muted=!1):($(this).removeClass("fa-volume-up").addClass("fa-volume-off"),m.muted=!0)})}function d(){if(window.screenTop||window.screenY){var a=screen.width,b=screen.height;v=!0}else{var a=o.originalWidth,b=o.originalHeight;v=!1}l.setSize(a,b),j.aspect=a/b,j.updateProjectionMatrix(),v?($(o).addClass("fullscreen"),$(o).find("a.fa-expand").removeClass("fa-expand").addClass("fa-compress")):($(o).removeClass("fullscreen"),$(o).find("a.fa-compress").removeClass("fa-compress").addClass("fa-expand"))}function e(){m.play()}function f(){m.pause()}function g(){if(requestAnimationFrame(g),m.readyState===m.HAVE_ENOUGH_DATA&&"undefined"!=typeof n){var a=(new Date).getTime();a-w>=30&&(n.needsUpdate=!0,w=a)}$(o).find("canvas")[0];h()}function h(){p=Math.max(-85,Math.min(85,p)),phi=(90-p)*Math.PI/180,theta=q*Math.PI/180;var a=500*Math.sin(phi)*Math.cos(theta),b=500*Math.cos(phi),c=500*Math.sin(phi)*Math.sin(theta);j.lookAt(new THREE.Vector3(a,b,c)),j.position.x=-a,j.position.y=-b,j.position.z=-c,l.clear(),l.render(k,j)}function i(a){console.info(a)}var j,k,l,m,n,o,p,q,r,s={play:e,stop:f,fullscreen:d},t={fov:35,lon:0,lat:0,loop:"loop",muted:!0,debug:!1,autoplay:!0},u='         <div class="controls">             <a href="#" class="playButton button fa fa-pause"></a>             <a href="#" class="muteButton button fa fa-volume-off"></a>             <a href="#" class="fullscreenButton button fa fa-expand"></a>         </div>     ',v=!1;$.fn.Valiant360=function(){if("string"==typeof arguments[0]){var c=(arguments[1],Array.prototype.slice.call(arguments));c.splice(0,1),s[arguments[0]].apply(this,c)}else a.apply(this,arguments),b.apply(this,arguments);return this.originalWidth=$(this).find("canvas").width(),this.originalHeight=$(this).find("canvas").height(),this},$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",d);var w=(new Date).getTime()}(jQuery);